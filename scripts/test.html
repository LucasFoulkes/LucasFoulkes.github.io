<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - effects - ascii</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <style>
      * {
        margin: 0;
      }
    </style>
  </head>

  <body>
    <div id="info">
      <a href="https://threejs.org" target="_blank" rel="noopener">three.js</a>
      - effects - ascii
    </div>

    <script type="module">
      import * as THREE from "/scripts/three.js-master/three.js-master/build/three.module.js";

      import { AsciiEffect } from "/scripts/three.js-master/three.js-master/examples/jsm/effects/AsciiEffect.js";
      import { TrackballControls } from "/scripts/three.js-master/three.js-master/examples/jsm/controls/TrackballControls.js";
      import { EffectComposer } from "/scripts/three.js-master/three.js-master/examples/jsm/postprocessing/EffectComposer.js";
      import { RenderPass } from "/scripts/three.js-master/three.js-master/examples/jsm/postprocessing/RenderPass.js";
      import { ShaderPass } from "/scripts/three.js-master/three.js-master/examples/jsm/postprocessing/ShaderPass.js";
      import { RGBShiftShader } from "/scripts/three.js-master/three.js-master/examples/jsm/shaders/RGBShiftShader.js";
      import { DotScreenShader } from "/scripts/three.js-master/three.js-master/examples/jsm/shaders/DotScreenShader.js";

      var camera, controls, scene, renderer, effect, composer;

      var sphere, plane;

      var start = Date.now();

      init();
      animate();

      function init() {
        camera = new THREE.PerspectiveCamera(
          70,
          window.innerWidth / window.innerHeight,
          1,
          1000
        );
        camera.position.y = 150;
        camera.position.z = 500;

        scene = new THREE.Scene();
        scene.background = new THREE.Color(0, 0, 0);

        var light = new THREE.PointLight(0xffffff);
        light.position.set(500, 500, 500);
        scene.add(light);

        var light = new THREE.PointLight(0xffffff, 0.25);
        light.position.set(-500, -500, -500);
        scene.add(light);

        sphere = new THREE.Mesh(
          new THREE.SphereBufferGeometry(200, 20, 10),
          new THREE.MeshPhongMaterial({ flatShading: true })
        );
        scene.add(sphere);

        // Plane

        plane = new THREE.Mesh(
          new THREE.PlaneBufferGeometry(400, 400),
          new THREE.MeshBasicMaterial({ color: 0xe0e0e0 })
        );
        plane.position.y = -200;
        plane.rotation.x = -Math.PI / 2;
        scene.add(plane);

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);

        // Special case: append effect.domElement, instead of renderer.domElement.
        // AsciiEffect creates a custom domElement (a div container) where the ASCII elements are placed.

        // document.body.appendChild(effect.domElement);

        // postprocessing

        composer = new EffectComposer(renderer);
        composer.addPass(new RenderPass(scene, camera));

        var effect = new ShaderPass(DotScreenShader);
        effect.uniforms["scale"].value = 4;
        composer.addPass(effect);

        var effect = new ShaderPass(RGBShiftShader);
        effect.uniforms["amount"].value = 0.0015;
        composer.addPass(effect);

        //

        document.body.appendChild(renderer.domElement);

        controls = new TrackballControls(camera, renderer.domElement);

        //

        window.addEventListener("resize", onWindowResize, false);
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);
        composer.setSize(window.innerWidth, window.innerHeight);
        // effect.setSize(window.innerWidth, window.innerHeight);
      }

      //

      function animate() {
        requestAnimationFrame(animate);

        render();
      }

      function render() {
        var timer = Date.now() - start;

        sphere.position.y = Math.abs(Math.sin(timer * 0.002)) * 150;
        sphere.rotation.x = timer * 0.0003;
        sphere.rotation.z = timer * 0.0002;

        controls.update();

        // renderer.render(scene, camera);
        composer.render();
      }
    </script>
  </body>
</html>
